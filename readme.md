# Forth computing system

Author:             

* Richard James Howe.

Copyright:          

* Copyright 2013-2017 Richard James Howe.

License:            

* MIT/LGPL

Email:              

* howe.r.j.89@gmail.com

## Introduction

This project implements a small stack computer tailored to executing Forth
based on the [J1][] CPU. The processor has been rewritten in [VHDL][] from
[Verilog][], and extended slightly. The project is a work in progress and is
needs a lot of work before become usable.

The goals of the project are as follows:

* Create a working version of [J1][] processor (called the H2).
* Make a working toolchain for the processor.
* Create a [FORTH][] for the processor which can take its input either from a
  [UART][] or a USB keyboard and a [VGA][] adapter.

The H2 processor, like the [J1][], is a stack based processor that executes an
instruction set especially suited for [FORTH][]. 

The current target is the [Nexys3][] board, new boards will be targeted in the
future as this board is reaching it's end of life. The [VHDL][] is written in a
generic way, with hardware components being inferred instead of explicitly
instantiated, this should make the code fairly portable.

## License

The licenses used by the project are mixed and are on a per file basis. For my
code I use the [MIT][] license - so feel free to use it as you wish. The other
licenses used are the [LGPL][], they are confined to single modules so could be
removed if you have some aversion to [LGPL][] code.

## Structure 

## Target Board

The only target board available at the moment is the [Nexys3][], this should
change in the future as the board is currently at it's End Of Life. The next
boards I am looking to support are it's successor, the Nexys 4, and the myStorm
BlackIce (<https://mystorm.uk/>). The myStorm board uses a completely open
source toolchain for synthesis, place and route and bit file generation.

## Build requirements

The build has been tested under [Debian][] [Linux][], version 8.

You will require:

* [GCC][], or a suitable [C][] compiler capable of compiling [C99][]
* [Make][]
* [Xilinx ISE][] version 14.7
* [GHDL][]
* [GTKWave][]
* [tcl][] version 8.6
* Digilent Adept2 runtime and Digilent Adept2 utilities available at
  <http://store.digilentinc.com/digilent-adept-2-download-only/>

[Xilinx ISE][] can (or could be) downloaded for free, but requires
registration. ISE needs to be on your path:

	PATH=$PATH:/opt/Xilinx/14.7/ISE_DS/ISE/bin/lin64;
	PATH=$PATH:/opt/Xilinx/14.7/ISE_DS/ISE/lib/lin64;

## Building 

To make a bit file that can be flashed to the target board:

	make simulation synthesis implementation bitfile

To upload the bitfile:

	make upload

To make the [C][] based toolchain:

	make h2

To view the wave form generated by "make simulation":

	make viewer

## To Do

* Fix bugs in:
	* UART
* Make a bootloader/program loader
* Implement Forth interpreter on device
* Memory interface to Nexys 3 board on board memory
* CHIP-8 emulator
* Redo Thesis and other documentation
* Add more assertions into the core
* Change license to MIT to files that can be changed.
* Make an emulator for the H2 Core in C.
  - Start of with a simple emulator with UART simulated
  with fgetc/fputc (this would require putting the terminal
  in raw mode first).
  - Work on an OpenGL version that emulators the screen.
* A graphics mode for the VGA core could be made, this
would allow address the screen as an array of pixels.
* The block RAM is allows for 18-bit access, look into this,
perhaps the instruction set could be extended - or parity bits
used.
* For CRC VHDL code see <http://outputlogic.com/?page_id=321>
* Better instructions for installation and building the project should be
  given.
* Add coding standards for VHDL.
* Each of the modules that I have made really need tests
benches written for them.
* Add "after" and try to model gate delays, this could be done incrementally,
  each entity only assigning its outputs after a delay after the timing for it
  has been worked out.
* Make test benches for all units I have made:
	- irqh.vhd
	- ledseg.vhd
	- util.vhd
* GPIO should be added, and perhaps a wave form generator.

## Ideas

* A multicore version could be made, one core could be used
for graphics processing, for example.

## Forth

* The on board memory could be linked up to the Forth block
word set.
* Most of the Forth code could be taken from my [libforth][]
project.

## Resources

* <https://nanode0000.wordpress.com/2017/04/08/exploring-the-j1-instruction-set-and-architecture/>
* <https://www.fpgarelated.com/showarticle/790.php>
* <https://opencores.org/>
* <https://en.wikipedia.org/wiki/Peephole_optimization>
* <https://en.wikipedia.org/wiki/Superoptimization>
* <https://github.com/samawati/j1eforth>

[J1]: http://www.excamera.com/sphinx/fpga-j1.html
[PL/0]: https://github.com/howerj/pl0
[libforth]: https://github.com/howerj/libforth/
[MIT]: https://en.wikipedia.org/wiki/MIT_License
[LGPL]: https://www.gnu.org/licenses/lgpl-3.0.en.html
[VHDL]: https://en.wikipedia.org/wiki/VHDL
[Verilog]: https://en.wikipedia.org/wiki/Verilog
[UART]: https://en.wikipedia.org/wiki/Universal_asynchronous_receiver/transmitter
[FORTH]: https://en.wikipedia.org/wiki/Forth_%28programming_language%29 
[VGA]: https://en.wikipedia.org/wiki/VGA
[Nexys3]: http://store.digilentinc.com/nexys-3-spartan-6-fpga-trainer-board-limited-time-see-nexys4-ddr/
[Make]: https://en.wikipedia.org/wiki/Make_%28software%29
[C]: https://en.wikipedia.org/wiki/C_%28programming_language%29
[Debian]: https://en.wikipedia.org/wiki/Debian
[Linux]: https://en.wikipedia.org/wiki/Linux
[GCC]: https://en.wikipedia.org/wiki/GNU_Compiler_Collection
[Xilinx ISE]: https://www.xilinx.com/products/design-tools/ise-design-suite.html
[GHDL]: http://ghdl.free.fr/
[GTKWave]: http://gtkwave.sourceforge.net/
[C99]: https://en.wikipedia.org/wiki/C99
[tcl]: https://en.wikipedia.org/wiki/Tcl

<style type="text/css">body{margin:40px auto;max-width:850px;line-height:1.6;font-size:16px;color:#444;padding:0 10px}h1,h2,h3{line-height:1.2}</style>
